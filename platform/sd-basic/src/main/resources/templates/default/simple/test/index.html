<!doctype html>
<html>
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta content="always" name="referrer">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<#include "../common/header.html">
 </head>
<body>
	<div   style="margin: 8px ">
		<table id="table_div" lay-filter="main" ></table>
	</div>


</body>
<#include "../common/layui_init.html">
<script type="text/html" id="barDemo">
	<a class="layui-btn layui-btn-xs" lay-event="detail">查看</a>
	<a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
	<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<script type="text/html" id="toolbarDemo">
	<div  style="margin-bottom: -5px">
		<div class="layui-btn-container " style="float: left;">
			<button class="layui-btn " lay-event="add"><i class="layui-icon layui-icon-add-1"></i>添加</button>
			<button class="layui-btn  layui-btn-normal" lay-event="update"><i class="layui-icon layui-icon-edit"></i>编辑</button>
			<button class="layui-btn   layui-btn-danger" lay-event="delete"><i class="layui-icon layui-icon-delete"></i>删除</button>
		</div>
		<form id="inquire">
			<div class="layui-input-block"  style="float:right">
				<div style="display: inline-block;width: 200px">
					<input type="text" name="startDate" class="layui-input"  id="startDate" placeholder="起始注册时间">
				</div>
				<div style="display: inline-block;width: 10px">
					<span>~</span>
				</div>
				<div style="display: inline-block;width: 200px">
					<input type="text" name="endDate" class="layui-input"  id="endDate" placeholder="最终注册时间">
				</div>

				<div  style="display: inline-block">
					<select name="city"  lay-verify="required" style="width: 150px">
						<option value="0" selected>所有角色</option>
						<option value="1">超级管理员</option>
						<option value="2">管理员</option>
						<option value="3">高级用户</option>
						<option value="4">普通用户</option>
					</select>
				</div>

				<input type="text" name="title" required  lay-verify="required" placeholder="用户姓名" autocomplete="off" class="layui-input" style="width: 240px;height: 38px;display: inline-block;">
				<button type="button" class="layui-btn "lay-event="search"  ><i class="layui-icon layui-icon-search"></i></button>

			</div>
		</form>

	</div>

</script>
<script type="text/javascript">
layui.use(['layer', 'form','table','laydate'],function () {
	var layer=layui.layer,layui_from=layui.form,layui_table=layui.table,lay_data=layui.laydate;

	var table_render={elem: '#table_div'
		,height: 600
		//数据接口
		,url: '${request.contextPath}/user/query'
		//接口http请求类型
		,method:'get'
		//默认每页数据条数
		,limit:20
		//开启分页
		,page: true
		//开启表格头部工具栏区域
		,toolbar:"#toolbarDemo"
		//默认工具
		,defaultToolbar:['filter', 'exports', 'print']
		//其他请求参数
		,where: {}
		//定义请求时相关分页参数
		,request: {
			//页码的参数名称，默认：page
			pageName: 'page'
			//每页数据量的参数名，默认：limit
			,limitName: 'rows'
		}
		//对分页返回数据进行转换
		,parseData: function(res){
			return {
				//解析接口状态
				"code": res.code,
				//解析提示文本
				"msg": res.msg,
				//解析数据长度
				"count": res.page.total,
				//解析数据列表
				"data": res.page.record
			};
		}
		,cols: [[ //表头

			{field: 'id', title: 'id', sort: true,type:'checkbox', fixed: 'left'}
			,{field: 'id', title: 'ID'}
			,{field: 'username', title: '用户名'}
			,{field: 'password', title: '密码'}
			,{field: 'sex', title: '性别'}
			,{field: 'email', title: '邮箱'}
			,{field: 'phone', title: '手机号'}
			,{field: 'remark', title: '备注'}
		]]
	}

	var tableins=layui_table.render(table_render);


	//执行一个laydate实例
	var startData=lay_data.render({
		elem: '#startDate' //指定元素
		,type:'date'
		,btns: ['clear','now', 'confirm']
		,calendar: true
	});
	//执行一个laydate实例
	var endDate=lay_data.render({
		elem: '#endDate' //指定元素
		,type:'date'
		,btns: ['clear','now', 'confirm']
		,calendar: true
	});



//监听事件
	layui_table.on('toolbar(main)', function(obj){
		var checkStatus = layui_table.checkStatus(obj.config.id);
		switch(obj.event){
			case 'add':
				layer.msg('添加');
				window.location.href="${request.contextPath}/p/view/test/edit";
				break;
			case 'delete':
				var checkStatus = layui_table.checkStatus('table_div'); //idTest 即为基础参数 id 对应的值
				var table_data =checkStatus.data;
				if(table_data.length>0){
					var ids=paraGetId(table_data);
					var ids_para=ArrayToString("ids",ids);
					if(table_data.length!=0){
						$.post("${request.contextPath}/user/remove"+ids_para,function(o){
							if(o.code==0){
								layer.msg(o.msg);
								layui.table.reload("table_div", table_render);
							}else{
								layer.alert(o.msg, {
									skin: 'layui-layer-molv' //样式类名
									,closeBtn: 0
									,title:"错误提示"
								});
							}
						});
					}
				}else{
					layer.msg("至少要选中一条数据",{icon:2});
				}


				break;
			case 'update':
				layer.msg('编辑');
				var checkStatus = layui_table.checkStatus('table_div'); //idTest 即为基础参数 id 对应的值
				var table_data =checkStatus.data;
				 console.log(checkStatus.data) //获取选中行的数据
				// console.log(checkStatus.data.length) //获取选中行数量，可作为是否有选中行的条件
				// console.log(checkStatus.isAll ) //表格是否全选
				if(table_data.length==1){
					var ids=paraGetOneId(table_data);
					if(table_data.length!=0){
						window.location.href="${request.contextPath}/p/view/test/edit?id="+ids;
					}
				}else{
					if(table_data.length==0){
						layer.msg("至少要选中一条数据",{icon:2});
					}else{
						layer.msg("只能选择一条数据",{icon:2});
					}
				}

				break;

				//var ids = jqGridTable1.selectOne();
				// if(ids != null){
				// 	window.location.href="${request.contextPath}/p/view/test/edit?id="+ids;
				// }
				// window.location.href="${request.contextPath}/p/view/test/edit";
			case 'search':
				table_render.where=paraArrayToLiteral($("#inquire").serializeArray());
				layui.table.reload("table_div", table_render)
				break;
		};
	});

	//监听提交
	// layui_from.on('submit(formDemo)', function(data){
	// 	layer.msg(JSON.stringify(data.field));
	// 	console.log(JSON.stringify(data.field));
	// 	tableins.reload({where:{a:111}});
	// 	lay_data_ins();
	// });







});
</script>
<#include "../common/footer-inner.html"> 
</html>

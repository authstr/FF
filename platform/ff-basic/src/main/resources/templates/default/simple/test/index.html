<!doctype html>
<html>
<head>
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta content="always" name="referrer">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<#include "../common/header.html">
	<style>
		.lightgray_div{
			background-color: lightgray;
			padding: 8px;
		}
		.white_div{
			background-color: #fffffa;
			padding-left: 0px;
			padding-right: 0px;
		}
		.search_div{
			margin-top: 8px;
		}
	</style>
 </head>
<body>
<!--最外面的灰底框,用于与ifram区别开-->
<div class="col-xs-12 lightgray_div" >
	<!--白底框-->
	<div class="col-xs-12 white_div">
		<!--搜索框-->
		<div class="col-xs-12 search_div" >
			<div class="input-group g-fr">
				<form id="inquire" class="form-inline ">
					<div class="input-group ">
						<select class="form-control"   name="role" id="role"    >
							<option value="0">所有角色</option>
							<option value="1">超级管理员</option>
							<option value="2">管理员</option>
							<option value="3">高级用户</option>
							<option value="4">普通用户</option>
						</select>
					</div>
					<div class="input-group ">
						<input type="text"  class="form-control"   id="gmt_create" placeholder="注册时间">
						<input type="hidden" id="gmt_create_start" name="gmt_create_start">
						<input type="hidden" id="gmt_create_end" name="gmt_create_end">
					</div>

					<div class="input-group ">
						<input type="text"  class="form-control" name="search" placeholder="用户姓名" >
					</div>
					<button type="button" class="layui-btn" style="height: 30px" onclick="table_func.search()" ><i class="layui-icon layui-icon-search"></i></button>
				</form>
			</div>
		</div>
		<div class="col-xs-12" >
			<div >
				<table id="table_div" lay-filter="main" ></table>
			</div>
		</div>
	</div>
</div>
</body>
<#include "../common/layui_init.html">
<script type="text/html" id="toolbarBox">
	<div  style="margin-bottom: -5px">
		<div class="layui-btn-container " style="float: left;">
			<button class="layui-btn " lay-event="add"><i class="layui-icon layui-icon-add-1"></i>添加</button>
			<button class="layui-btn  layui-btn-normal" lay-event="update"><i class="layui-icon layui-icon-edit"></i>编辑</button>
			<button class="layui-btn   layui-btn-danger" lay-event="delete"><i class="layui-icon layui-icon-delete"></i>删除</button>
		</div>
	</div>
</script>
<script type="text/javascript">
	//设置表格的属性值
	layui_table.lay_attr=$("#table_div").attr("lay-filter");
	//设置点击表格行,进行选中
	layui_table.click_line_checked();

	var cols=[[ //表头
		{field: 'id', title: 'id', sort: true,type:'checkbox', fixed: 'left'}
		,{field: 'id', title: 'ID'}
		,{field: 'username', title: '用户名'}
		,{field: 'password', title: '密码'}
		,{field: 'sex', title: '性别'}
		,{field: 'email', title: '邮箱'}
		,{field: 'phone', title: '手机号'}
		,{field: 'remark', title: '备注'}
	]]
	layui_table.set_table_data('${request.contextPath}/user/query',cols,"#toolbarBox");
	layui_table.table_render();
	layui_date.range_date_render("#gmt_create","date","#gmt_create_start","#gmt_create_end");

	table_func={
		search:function(){
			console.log($("#inquire").serializeArray());
			console.log(paraArrayToLiteral($("#inquire").serializeArray()));
			layui_table.search(paraArrayToLiteral($("#inquire").serializeArray()))
		}
	}

	$("#role").select2();


layui.use(['layer', 'form','table','laydate'],function () {

	var layer=layui.layer,layui_from=layui.form,layui_table=layui.table,lay_data=layui.laydate;

	// //执行一个laydate实例
	// var startData=lay_data.render({
	// 	elem: '#startDate' //指定元素
	// 	,type:'date'
	// 	,btns: ['clear','now', 'confirm']
	// 	,calendar: true
	// });
	// //执行一个laydate实例
	// var endDate=lay_data.render({
	// 	elem: '#endDate' //指定元素
	// 	,type:'date'
	// 	,btns: ['clear','now', 'confirm']
	// 	,calendar: true
	// });




	//监听事件
	layui_table.on('toolbar(main)', function(obj){
		var checkStatus = layui_table.checkStatus(obj.config.id);
		switch(obj.event){
			case 'add':
				layer.msg('添加');
				window.location.href="${request.contextPath}/p/view/test/edit";
				break;
			case 'delete':
				var checkStatus = layui_table.checkStatus('table_div'); //idTest 即为基础参数 id 对应的值
				var table_data =checkStatus.data;
				if(table_data.length>0){
					var ids=paraGetId(table_data);
					var ids_para=ArrayToString("ids",ids);
					if(table_data.length!=0){
						$.post("${request.contextPath}/user/remove"+ids_para,function(o){
							if(o.code==0){
								layer.msg(o.msg);
								layui.table.reload("table_div", table_render);
							}else{
								layer.alert(o.msg, {
									skin: 'layui-layer-molv' //样式类名
									,closeBtn: 0
									,title:"错误提示"
								});
							}
						});
					}
				}else{
					layer.msg("至少要选中一条数据",{icon:2});
				}


				break;
			case 'update':
				layer.msg('编辑');
				var checkStatus = layui_table.checkStatus('table_div'); //idTest 即为基础参数 id 对应的值
				var table_data =checkStatus.data;
				 console.log(checkStatus.data) //获取选中行的数据
				// console.log(checkStatus.data.length) //获取选中行数量，可作为是否有选中行的条件
				// console.log(checkStatus.isAll ) //表格是否全选
				if(table_data.length==1){
					var ids=paraGetOneId(table_data);
					if(table_data.length!=0){
						window.location.href="${request.contextPath}/p/view/test/edit?id="+ids;
					}
				}else{
					if(table_data.length==0){
						layer.msg("至少要选中一条数据",{icon:2});
					}else{
						layer.msg("只能选择一条数据",{icon:2});
					}
				}

				break;

				//var ids = jqGridTable1.selectOne();
				// if(ids != null){
				// 	window.location.href="${request.contextPath}/p/view/test/edit?id="+ids;
				// }
				// window.location.href="${request.contextPath}/p/view/test/edit";
			case 'search':
				table_render.where=paraArrayToLiteral($("#inquire").serializeArray());
				layui.table.reload("table_div", table_render)
				break;
		};
	});

	//监听提交
	// layui_from.on('submit(formDemo)', function(data){
	// 	layer.msg(JSON.stringify(data.field));
	// 	console.log(JSON.stringify(data.field));
	// 	tableins.reload({where:{a:111}});
	// 	lay_data_ins();
	// });






});
</script>
<#include "../common/footer-inner.html"> 
</html>
